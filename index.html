<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <title>Cave Miner ‚Äî PezzaliAPP Edition v2 (PWA)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
  <meta name="theme-color" content="#0b1022">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="./manifest.webmanifest">
  <!-- icona corretta: icons/ -->
  <link rel="icon" type="image/png" href="./icons/icon-192.png">
  <link rel="apple-touch-icon" href="./icons/icon-192.png">
  <style>
    :root{ --bg:#0b1022; --panel:#0e1533; --line:#1a2559; --fg:#eaf1ff; }
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--fg);font:15px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial}
    header{padding:8px 12px;background:var(--panel);border-bottom:1px solid var(--line);display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    header h1{margin:0;font-size:16px}
    #hud{margin-left:auto;display:flex;gap:10px;align-items:center}
    #hud .pill{background:#0e1533bd;border:1px solid var(--line);border-radius:10px;padding:6px 10px}
    #wrap{display:flex;flex-direction:column;min-height:100%}
    #gamebox{flex:1;display:flex;align-items:center;justify-content:center;padding:10px}
    canvas{background:#090f28;border:1px solid var(--line);border-radius:12px;touch-action:none}
    .btn{user-select:none;-webkit-user-select:none;touch-action:manipulation;border:1px solid var(--line);background:#141c44;color:var(--fg);border-radius:16px;padding:10px 14px;min-width:64px;text-align:center}
    #panel{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    select{background:#111a3b;border:1px solid var(--line);color:var(--fg);border-radius:10px;padding:6px 10px}
    #pad{
      position:fixed;left:0;right:0;bottom:0;z-index:9999;
      padding:12px 10px calc(env(safe-area-inset-bottom,0px) + 12px);
      background:linear-gradient(#0e1533cc,#0e1533ee);
      display:flex;gap:12px;align-items:center;justify-content:center;
      touch-action:none;-webkit-user-select:none;user-select:none;
    }
    .dpad{display:grid;grid-template-columns:repeat(3,64px);grid-template-rows:repeat(2,64px);gap:10px}
    .wide{min-width:120px;font-weight:600}
    .hidden{display:none!important}
    @media (min-width:900px){ #pad{display:none} }
    #start{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.55);z-index:20000}
    #start .panel{background:#0e1533;border:1px solid #1a2559;border-radius:14px;padding:16px 18px;max-width:520px}
    #start h2{margin:0 0 6px;font:700 18px/1.2 system-ui,-apple-system,Segoe UI,Roboto,Arial}
    #start p{margin:0 0 12px; opacity:.9}
    @media (max-width:900px){ #gamebox{padding:10px 10px 190px} }
  </style>
</head>
<body>
<header>
  <h1>Cave Miner ‚Äî PezzaliAPP Edition v2</h1>
  <div id="panel">
    <span>Livello:</span>
    <select id="levelSel"></select>
    <button id="btnPlay" class="btn">Gioca</button>
  </div>
  <div id="hud">
    <div class="pill">‚è± <span id="time">0</span>s</div>
    <div class="pill">üíé <span id="diamonds">0</span>/<span id="need">0</span></div>
    <div class="pill">‚ù§ <span id="lives">3</span></div>
    <button id="btnMute" class="btn">üîä</button>
    <button id="btnInstall" class="btn" style="display:none">‚¨áÔ∏è Installa</button>
  </div>
</header>

<div id="wrap">
  <div id="gamebox"><canvas id="game" width="480" height="336" tabindex="0"></canvas></div>
</div>

<div id="pad">
  <div class="dpad" aria-hidden="true">
    <div class="btn" data-k="ArrowLeft">‚óÄÔ∏é</div>
    <div class="btn" data-k="ArrowUp">‚ñ≤</div>
    <div class="btn" data-k="ArrowRight">‚ñ∂Ô∏é</div>
    <div class="btn" data-k="ArrowDown">‚ñº</div>
    <div class="btn" data-k="Space">‚è∏</div>
    <div class="btn wide" data-k="KeyR">Ricomincia</div>
  </div>
</div>

<div id="start">
  <div class="panel">
    <h2>Cave Miner v2</h2>
    <p>Raccogli i diamanti richiesti, poi entra nell'uscita <b>verde</b>. Evita i crolli!</p>
    <p>Desktop: frecce ‚Ä¢ Space pausa ‚Ä¢ R ricomincia. Mobile: usa il pad.</p>
    <button id="btnStart" class="btn wide">‚ñ∂Ô∏é START</button>
  </div>
</div>

<audio id="sfx_push"></audio>
<audio id="sfx_fall"></audio>
<audio id="sfx_pick"></audio>
<audio id="sfx_win"></audio>

<script src="./app.js"></script>
<script>
(function(){
  var btn = document.getElementById('btnInstall'), de=null;
  window.addEventListener('beforeinstallprompt', function(e){ e.preventDefault(); de=e; btn.style.display='inline-block'; });
  btn.addEventListener('click', function(){ if(de){ de.prompt(); de=null; btn.style.display='none'; } });
})();
</script>
</body>
</html>
